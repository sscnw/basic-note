#第一章
###1.1.3 数据库系统的特点
- 数据结构化：描述数据时不单单描述数据本身，还要描述数据间的联系
- 数据的共享性高，冗余度低，易扩充：被多个用户，应用共享使用，节约存储空间
- 数据独立性高：物理独立性-用户的应用程序与存储在磁盘上的数据库中数据是相互独立的，也就是说数据在磁盘上的数据库中怎样存储是由DBMS管理的，用户程序不需要了解。应用程序只要处理逻辑结构
逻辑独立性是指用户的应用程序与数据库的逻辑结构是相互独立的，也就是说，逻辑结构改变了，用户程序也可以不变
- 数据由DBMS同一管理和控制
	- 数据的安全性保护
	- 数据的完整性检查：将数据控制在有效的范围内
	- 并发控制：多个用户的并发进程同时存取，修改数据库的协调
	数据库恢复
###1.2.1 两类数据模型
- 概念模型
- 逻辑模型：层次模型，网状模型，关系模型等
###1.2.2数据模型的组成要素
- 数据结构：数据库的组成对象以及对象间的关系
- 数据操作：数据库中各种对象的实例允许执行的操作的集合
- 完整性约束条件：一组完整性规则
###1.3.2数据库系统的三级模式结构
- 由外模式（多），模式（单）和内模式（单）三级构成
###1.3.3数据库的二级映像功能与数据独立性
###DDL和DML
- DDL （Data Definition Language 数据定义语言）
```
create table 创建表     
alter table  修改表   
drop table 删除表   
truncate table 删除表中所有行     
create index 创建索引   
drop index  删除索引
```
当执行DDL语句时，在每一条语句前后，oracle都将提交当前的事务。
如果用户使用insert命令将记录插入到数据库后，执行了一条DDL语句(如create table)，此时来自insert命令的数据将被提交到数据库。
当DDL语句执行完成时，DDL语句会被自动提交，不能回滚。 

- DML （Data Manipulation Language 数据操作语言） 
```
insert 将记录插入到数据库 
update 修改数据库的记录 
delete 删除数据库的记录
```
当执行DML命令如果没有提交，将不会被其他会话看到。
除非在DML命令之后执行了DDL命令或DCL命令，或用户退出会话，或终止实例，此时系统会自动发出commit命令，使未提交的DML命令提交。
#第二章
###2.3.1关系的三类完整性约束
- 实体完整性：主属性不能取空值
	- 检查和违约处理：
		- 检查主码值是否唯一，如果不唯一则拒绝插入或修改
		- 检查主码的各个属性是否为空，只要有一个为空就拒绝插入和修改
	- 检查的方法一种是全表扫描：费时，为了避免全表扫描，会在主码上自动建立一个B+树索引
	- B+数索引具有动态平衡额特点
	- Hash索引具有查找速度快的特点
- 参照完整性：空值或者必须是关系中存在的元组中的值
	- 处理：拒绝 NO ACTION 级联操作 CASCADE 设置为NULL
- 自定义的完整性
#第六章：关系数据理论
##问题的提出
- 函数依赖：y=f(x) 的关系，如Sname=f(Sno),Sname函数依赖于Sno，Sno-》Sname
- 有些函数依赖的关系模式存在一定的问题
	- 数据冗余太大
	- 更新异常
	- 插入异常
	- 删除异常
##规范化
- 函数依赖
	- 完全函数依赖：设X,Y是关系R的两个属性集合，X’是X的真子集，存在X→Y，但对每一个X’都有X’!→Y，则称Y完全函数依赖于X。
	通过AB能得出C，但是AB单独得不出C，那么说C完全依赖于AB.
	 - 部分函数依赖：设X,Y是关系R的两个属性集合，存在X→Y，若X’是X的真子集，存在X’→Y，则称Y部分函数依赖于X。
	 通过AB能得出C，通过A也能得出C，通过B也能得出C，那么说C部分依赖于AB。
	-  传递函数依赖：设X,Y,Z是关系R中互不相同的属性集合，存在X→Y(Y !→X),Y→Z，则称Z传递函数依赖于X。
	 举个例子：通过A得到B，通过B得到C，但是C得不到B，B得不到A，那么成C传递依赖于A
- 多值依赖
	-  
###6.2.3 范式
- 1NF
	关系的每一个分量必须是不可分的数据项
	- 问题：插入异常，删除异常，修改复杂
- 2NF
	R中所有非主属性完全依赖于每个键，包括候选键
-3NF
没有非主属性传递依赖于键，去除了所有的传递依赖
- BCNF

###ER图
- 1:1
	- 班级（**编号**，专业）
班长（**学号**，姓名）
管理（**编号，学号**）
	- 或者
	班级（**编号**，专业，**班长学号**）
班长（**学号**，姓名）
- 1:n
	- 班级（**编号**，专业）
同学（**学号**，姓名）
管理（编号，学号）
	- 或者
班级（**编号**，专业）
同学（**学号**，姓名，班级编号）
- m:n
	- 学生（**学号**，姓名）
课程（**课号**，课名）
选修（**学号**，**课号**，成绩）
- 具有相同码的关系模式可合并
	- 目的：减少系统中的关系个数
	- 合并方法：将其中一个关系模式的全部属性加入到另一个关系模式中，然后去掉其中的同义属性（可能同名也可能不同名），并适当调整属性的次序
### 关系模式存取方法选择
- DBMS常用存取方法
	- 索引方法
		目前主要是B+树索引方法
		经典存取方法，使用最普遍 
	- 聚簇（Clustered）方法
	- HASH方法
- 索引存取方法的选择
	- 选择索引存取方法的一般规则
		- 如果一个(一组)属性经常在查询条件中出现，则考虑在这个(或这组)属性上建立索引(或组合索引)
		- 如果一个属性经常作为最大值和最小值等聚集函数的参数，则考虑在这个属性上建立索引
		- 如果一个(或一组)属性经常在连接操作的连接条件中出现，则考虑在这个(或这组)属性上建立索引
	- 根据应用要求确定
 对哪些属性列建立索引
 对哪些属性列建立组合索引
 对哪些索引要设计为唯一索引
	- 关系上定义的索引数过多会带来较多的额外开销
维护索引的开销
查找索引的开销
- 聚簇存取方法的选择
	- 为了提高某个属性（或属性组）的查询速度，把这个或这些属性（称为聚簇码）上具有相同值的元组集中存放在连续的物理块称为聚簇
	- 聚簇的用途
		- 大大提高按聚簇码进行查询的效率
例：假设学生关系按所在系建有索引，现在要查询信息系的所有学生名单。
信息系的500名学生分布在500个不同的物理块上时，至少要执行500次I/O操作
如果将同一系的学生元组集中存放，则每读一个物理块可得到多个满足查询条件的元组，从而显著地减少了访问磁盘的次数
 		- 节省存储空间
聚簇以后，聚簇码相同的元组集中在一起了，因而聚簇码值不必在每个元组中重复存储，只要在一组中存一次就行了
	- 聚簇的局限性 
		- 聚簇只能提高某些特定应用的性能
		-  建立与维护聚簇的开销相当大
对已有关系建立聚簇，将导致关系中元组移动其物理存储位置，并使此关系上原有的索引无效，必须重建
当一个元组的聚簇码改变时，该元组的存储位置也要做相应移动
	- 聚簇的适用范围 ：
		- 既适用于单个关系独立聚簇，也适用于多个关系组合聚簇
	例：假设用户经常要按系别查询学生成绩单，这一查询涉及学生关系和选修关系的连接操作，即需要按学号连接这两个关系，为提高连接操作的效率，可以把具有相同学号值的学生元组和选修元组在物理上聚簇在一起。这就相当于把多个关系按“预连接”的形式存放，从而大大提高连接操作的效率。
		- 当通过聚簇码进行访问或连接是该关系的主要应用，与聚簇码无关的其他访问很少或者是次要的时，可以使用聚簇。
尤其当SQL语句中包含有与聚簇码有关的ORDER BY，GROUP BY，UNION，DISTINCT等子句或短语时，使用聚簇特别有利，可以省去对结果集的排序操作
	- 设计候选聚簇 
	对经常在一起进行连接操作的关系可以建立聚簇
如果一个关系的一组属性经常出现在相等比较条件中，则该单个关系可建立聚簇
如果一个关系的一个(或一组)属性上的值重复率很高，则此单个关系可建立聚簇。即对应每个聚簇码值的平均元组数不太少。太少了，聚簇的效果不明显
	- 优化聚簇设计
	从聚簇中删除经常进行全表扫描的关系；
从聚簇中删除更新操作远多于连接操作的关系
不同的聚簇中可能包含相同的关系，一个关系可以在某一个聚簇中，但不能同时加入多个聚簇 
从这多个聚簇方案(包括不建立聚簇)中选择一个较优的，即在这个聚簇上运行各种事务的总代价最小
- HASH存取方法的选择
	- 当一个关系满足下列两个条件时，可以选择HASH存取方法
该关系的属性主要出现在等值连接条件中或主要出现在相等比较选择条件中
该关系的大小可预知，而且不变； 
或
该关系的大小动态改变，但所选用的DBMS提供了动态HASH存取方法
###7.4.4 确定数据库的存储结构
- 确定数据库物理结构的内容
	- 确定数据的存放位置和存储结构
 关系
 索引
 聚簇
 日志
 备份
	- 确定系统配置
- 确定数据的存放位置——基本原则 
	- 根据应用情况将易变部分与稳定部分分开存放
	存取频率较高部分与存取频率较低部分，分开存放
- 例子：
	- 数据库数据备份、日志文件备份等由于只在故障恢复时才使用，而且数据量很大，可以考虑存放在磁带上
	- 如果计算机有多个磁盘或磁盘阵列 ，可以考虑将表和索引分别放在不同的磁盘上，在查询时，由于磁盘驱动器并行工作，可以提高物理I/O读写的效率 
	- 可以将比较大的表分别放在两个磁盘上，以加快存取速度，这在多用户环境下特别有效
	- 可以将日志文件与数据库对象（表、索引等）放在不同的磁盘以改进系统的性能
# 数据库恢复技术
##事务的基本概念
